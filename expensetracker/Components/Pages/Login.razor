@page "/login"
@using expensetracker.Models
@inject IDataService DataService
@inject NavigationManager Nav

<h3 class="text-center mb-4">Login to Your Account</h3>

<div class="container shadow rounded p-4 bg-white" style="max-width: 400px;">
    <div class="form-group mb-3">
        <label for="username">Username</label>
        <input id="username" class="form-control" @bind="Username" placeholder="Enter your username" />
    </div>

    <div class="form-group mb-3">
        <label for="password">Password</label>
        <input id="password" type="password" class="form-control" @bind="Password" placeholder="Enter your password" />
    </div>

    <div class="d-grid gap-2 mb-2">
        <button class="btn btn-primary" @onclick="LoginUser">Login</button>
        <button class="btn btn-outline-secondary" @onclick="GoToSignup">Create New Account</button>
    </div>

    @if (!string.IsNullOrWhiteSpace(ErrorMessage))
    {
        <div class="alert alert-danger mt-3" role="alert">@ErrorMessage</div>
    }
</div>

@code {
    private string Username = string.Empty;
    private string Password = string.Empty;
    private string ErrorMessage = string.Empty;

    private async Task LoginUser()
    {
        ErrorMessage = string.Empty;

        if (string.IsNullOrWhiteSpace(Username) || string.IsNullOrWhiteSpace(Password))
        {
            ErrorMessage = "Please enter both username and password.";
            return;
        }

        var success = await DataService.LoginAsync(Username.Trim(), Password);
        if (success)
        {
            Nav.NavigateTo("/dashboard");
        }
        else
        {
            ErrorMessage = "Invalid username or password. Please try again.";
        }
    }

    private void GoToSignup()
    {
        Nav.NavigateTo("/signup");
    }
}
