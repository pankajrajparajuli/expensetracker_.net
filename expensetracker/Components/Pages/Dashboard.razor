@page "/dashboard"
@using expensetracker.Models
@inject IDataService DataService
@inject NavigationManager Nav

<h3 class="mb-4">Welcome, @CurrentUsername!</h3>

<div class="container">
    <div class="alert alert-info">
        This is your dashboard. You can manage transactions, settings, and more from here.
    </div>

    <div class="row g-3 mt-4">
        <div class="col-md-6">
            <div class="card border-primary">
                <div class="card-body">
                    <h5 class="card-title">Add New Transaction</h5>
                    <p class="card-text">Record income, expenses, or debt.</p>
                    <button class="btn btn-primary" @onclick="@(() => Nav.NavigateTo("/addtransaction"))">Add Transaction</button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-success">
                <div class="card-body">
                    <h5 class="card-title">View All Transactions</h5>
                    <p class="card-text">Search, filter, and analyze past transactions.</p>
                    <button class="btn btn-success" @onclick="@(() => Nav.NavigateTo("/viewtransactions"))">View Transactions</button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-secondary">
                <div class="card-body">
                    <h5 class="card-title">Settings</h5>
                    <p class="card-text">Update your preferences and currency.</p>
                    <button class="btn btn-secondary" @onclick="@(() => Nav.NavigateTo("/settings"))">Go to Settings</button>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-danger">
                <div class="card-body">
                    <h5 class="card-title text-danger">Logout</h5>
                    <p class="card-text">Sign out from your account.</p>
                    <button class="btn btn-outline-danger" @onclick="Logout">Logout</button>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string CurrentUsername = "";

    protected override async Task OnInitializedAsync()
    {
        var session = await DataService.GetSessionAsync();

        if (session is null || !session.IsLoggedIn)
        {
            Nav.NavigateTo("/login", forceLoad: true);
            return;
        }

        CurrentUsername = session.Username;
    }

    private async Task Logout()
    {
        await DataService.LogoutAsync();
        Nav.NavigateTo("/login", forceLoad: true);
    }
}
